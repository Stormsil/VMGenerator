<Window x:Class="VMGenerator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="VM Generator - Clone &amp; Configure">

    <Grid x:Name="RootGrid" Loaded="Window_Loaded" KeyDown="Window_KeyDown" Background="#2B2B2B">
        <Grid.Resources>
        <ResourceDictionary>
            <ResourceDictionary.ThemeDictionaries>
                <ResourceDictionary x:Key="Default">
                    <SolidColorBrush x:Key="Success" Color="#4caf50"/>
                        <SolidColorBrush x:Key="ProxmoxGray" Color="#262626"/>
                    <SolidColorBrush x:Key="ProxmoxDarkGray" Color="#2B2B2B"/>
                    <SolidColorBrush x:Key="ProxmoxBlue" Color="#5294E2"/>
                </ResourceDictionary>
            </ResourceDictionary.ThemeDictionaries>

            <!-- Proxmox-style button -->
            <Style x:Key="ProxmoxButton" TargetType="Button">
                <Setter Property="Background" Value="#505050"/>
                <Setter Property="Foreground" Value="#E0E0E0"/>
                <Setter Property="BorderBrush" Value="#666666"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="CornerRadius" Value="3"/>
            </Style>

            <!-- Proxmox-style accent button (blue) -->
            <Style x:Key="ProxmoxAccentButton" TargetType="Button">
                    <Setter Property="Background" Value="#e26d00"/>
                <Setter Property="Foreground" Value="White"/>
                    <Setter Property="BorderBrush" Value="#e26d00"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="CornerRadius" Value="3"/>
            </Style>
        </ResourceDictionary>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TOP BAR -->
        <Grid Grid.Row="0" Padding="16,12" Background="{ThemeResource ProxmoxGray}"
              BorderBrush="#555555" BorderThickness="0,0,0,1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Controls -->
            <StackPanel Orientation="Horizontal" Grid.Column="0" Spacing="8">
                <Button x:Name="BtnConfig" Content="Config" Click="BtnConfig_Click"
                        Style="{StaticResource ProxmoxButton}">
                    <ToolTipService.ToolTip>
                        <ToolTip Content="Открыть настройки"/>
                    </ToolTipService.ToolTip>
                </Button>
                <Button x:Name="BtnStart" Content="Start (F5)" Click="BtnStart_Click" Style="{StaticResource ProxmoxAccentButton}"/>
                <Button x:Name="BtnStop" Content="Stop (F6)" Click="BtnStop_Click" Style="{StaticResource ProxmoxButton}" IsEnabled="False"/>
                <Button x:Name="BtnReset" Content="Reset (F7)" Click="BtnReset_Click" Style="{StaticResource ProxmoxButton}">
                    <ToolTipService.ToolTip>
                        <ToolTip Content="Сбросить браузер (принудительно)"/>
                    </ToolTipService.ToolTip>
                </Button>
            </StackPanel>

            <!-- Current operation -->
            <TextBlock x:Name="CurrentOpText" Grid.Column="1"
                      VerticalAlignment="Center" Margin="0,0,16,0"
                      FontStyle="Italic" FontSize="12" Opacity="0.6"/>

            <!-- Status badge -->
            <Border x:Name="StatusBadge" Grid.Column="2" CornerRadius="4" Padding="12,6"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                <TextBlock x:Name="StatusText" FontSize="12"/>
            </Border>
        </Grid>

        <!-- MAIN: browser + panel -->
        <Grid Grid.Row="1" Margin="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="640" Width="2*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition x:Name="RightPanelColumn" MinWidth="400" Width="400"/>
            </Grid.ColumnDefinitions>

            <WebView2 x:Name="Browser" Grid.Column="0"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Border Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                <Button x:Name="BtnTogglePanel" Content="▶" 
                        Click="BtnTogglePanel_Click"
                        VerticalAlignment="Center" Margin="-12,0,0,0"
                        Width="24" Height="48" CornerRadius="4,0,0,4"
                        Background="{ThemeResource ProxmoxGray}"
                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                        BorderThickness="1,1,0,1"
                        ToolTipService.ToolTip="Скрыть/показать панель"/>
            </StackPanel>

            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Queue panel -->
                <Grid Grid.Row="0" Padding="16" Background="{ThemeResource ProxmoxGray}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Row="0" Spacing="12" Margin="0,0,0,16">
                        <TextBlock Text="VM Queue" FontWeight="SemiBold" FontSize="16" VerticalAlignment="Center"/>
                        <Button x:Name="BtnAdd" Content="+ Add" Click="BtnAdd_Click" Style="{ThemeResource ProxmoxAccentButton}"/>
                        <Button x:Name="BtnClear" Content="Clear" Click="BtnClear_Click"/>
                    </StackPanel>

                    <Grid Grid.Row="1" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="110"/>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Name" FontSize="12" FontWeight="SemiBold" Opacity="0.6"/>
                        <TextBlock Grid.Column="1" Text="Storage" FontSize="12" FontWeight="SemiBold" Opacity="0.6"/>
                        <TextBlock Grid.Column="2" Text="Status" FontSize="12" FontWeight="SemiBold" Opacity="0.6"/>
                    </Grid>

                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="QueueList">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Spacing="8"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="140"/>
                                            <ColumnDefinition Width="110"/>
                                            <ColumnDefinition Width="60"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Text="{Binding Name, Mode=TwoWay}" Margin="0,0,4,0"/>

                                        <ComboBox Grid.Column="1" Margin="0,0,4,0" Tag="Storage"
                                                  SelectedItem="{Binding Storage, Mode=TwoWay}"
                                                  Loaded="ComboBox_Loaded"/>

                                        <TextBlock Grid.Column="2" Margin="0,0,4,0" VerticalAlignment="Center"
                                                   HorizontalAlignment="Center" FontSize="14"
                                                   Text="{Binding StatusText}"
                                                   Foreground="{Binding StatusColor}"/>

                                        <Button Grid.Column="3" Content="✕" Click="BtnRemoveRow_Click"
                                                FontSize="10" Width="32" Height="32"
                                                ToolTipService.ToolTip="Удалить из очереди"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>

                <Border Grid.Row="1" Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

                <!-- Command panel (new) -->
                <Grid Grid.Row="2" x:Name="CommandPanel" Padding="16,12" Background="{ThemeResource ProxmoxGray}"
                      BorderBrush="#555555" BorderThickness="0,0,0,1" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="Command:" FontWeight="SemiBold"
                               VerticalAlignment="Center" Margin="0,0,12,0"/>

                    <TextBox Grid.Column="1" x:Name="CommandTextBox"
                             IsReadOnly="True"
                             FontFamily="Cascadia Mono, Consolas"
                             FontSize="12"
                             Margin="0,0,8,0"/>

                    <Button Grid.Column="2" x:Name="BtnCopyCommand" Content="Copy"
                            Click="BtnCopyCommand_Click"
                            Style="{StaticResource ProxmoxButton}">
                        <ToolTipService.ToolTip>
                            <ToolTip Content="Скопировать команду в буфер обмена"/>
                        </ToolTipService.ToolTip>
                    </Button>
                </Grid>

                <!-- Log panel -->
                <StackPanel Grid.Row="3" x:Name="LogPanel" Background="{ThemeResource ProxmoxGray}">
                    <Grid Padding="16,12"
                          Background="{ThemeResource ProxmoxGray}"
                          BorderBrush="#555555" BorderThickness="0,1,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Log" FontWeight="SemiBold" FontSize="16" VerticalAlignment="Center"/>
                        
                        <Button Grid.Column="1" x:Name="BtnExpandLog" Content="&#xE740;" Click="BtnExpandLog_Click"
                                FontFamily="Segoe MDL2 Assets" Margin="0,0,8,0">
                            <ToolTipService.ToolTip>
                                <ToolTip Content="Открыть лог в отдельном окне"/>
                            </ToolTipService.ToolTip>
                        </Button>

                        <Button Grid.Column="2" x:Name="BtnToggleLog" Content="&#xE70E;" Click="BtnToggleLog_Click"
                                FontFamily="Segoe MDL2 Assets" Margin="0,0,8,0">
                            <ToolTipService.ToolTip>
                                <ToolTip Content="Свернуть/развернуть панель логов"/>
                            </ToolTipService.ToolTip>
                        </Button>

                        <Button Grid.Column="3" x:Name="BtnCopyLog" Content="Copy" Click="BtnCopyLog_Click"
                                Style="{ThemeResource ProxmoxButton}">
                            <ToolTipService.ToolTip>
                                <ToolTip Content="Скопировать весь лог в буфер обмена"/>
                            </ToolTipService.ToolTip>
                        </Button>
                    </Grid>

                    <ScrollViewer x:Name="LogScrollViewer" Height="300" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="LogBox" Padding="16" Background="{ThemeResource ProxmoxDarkGray}"/>
                    </ScrollViewer>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>
